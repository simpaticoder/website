<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SET Game in Vanilla JS</title>
    <style>
        body { font-family: sans-serif; background: #f0f1f3; margin: 0; padding: 0; }
        h1 { text-align: center; }
        #game { display: flex; flex-direction: column; align-items: center; }
        #board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, auto);
            gap: 12px;
            width: 520px;   /* 4 × 120px card + 3 × 12px gap */
            margin-top: 20px;
            justify-content: center;
        }

        .card { cursor: pointer;  border-radius: 14px;
            border: 2px solid #ddd; background: #fff; box-shadow: 1px 2px 7px #bbb4; transition: box-shadow 0.15s, border-color 0.15s; }
        .selected { border-color: #E27905 !important; box-shadow: 0 0 0 4px #FFD580aa; }
        .set { border-color: #48A14D !important; box-shadow: 0 0 0 4px #98F8A6aa; }
        .notset { border-color: #BC2A28 !important; box-shadow: 0 0 0 4px #FF9D97aa; }
        .hint {
            border-color: #3bc4e9 !important;
            box-shadow: 0 0 0 4px #87e2ff99;
        }

        #deckcount { margin-top: 1em; }
        #message {margin-top: 16px; height: 28px; font-weight: bold;}
        button { margin-left: 1em; cursor:pointer; }
    </style>
</head>
<body>

<h1>SET Game (Vanilla JS)</h1>
<div id="game">
    <div id="deckcount"></div>
    <div id="board"></div>
    <div id="message"></div>
    <button id="add3">Add 3 Cards</button>
    <button id="restart">Restart</button>
    <button id="noSet">No Set</button>
    <button id="highlightSet">Highlight a Set</button>
</div>

<script>
    // Deck generation (4 attributes, 3 values each)
    function generateDeck() {
        const deck = [];
        for (let a = 0; a < 3; a++)
            for (let b = 0; b < 3; b++)
                for (let c = 0; c < 3; c++)
                    for (let d = 0; d < 3; d++)
                        deck.push([a, b, c, d]);
        return deck;
    }
    // Fisher-Yates shuffle
    function shuffle(deck) {
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }
    function findAnySet(board) {
        for (let i = 0; i < board.length; i++) {
            for (let j = i+1; j < board.length; j++) {
                for (let k = j+1; k < board.length; k++) {
                    if (isSet([board[i], board[j], board[k]])) {
                        return [i, j, k];
                    }
                }
            }
        }
        return null;
    }

    // Card to SVG string
    function cardToSVG([number, symbol, shading, color], width = 120, height = 180) {
        const colors = ['#d22', '#292', '#828'];
        const symbolYs = [
            [height / 2],
            [height / 2 - 24, height / 2 + 24],
            [height / 2 - 36, height / 2, height / 2 + 36]
        ][number];

        // Pattern uses color of the card
        const patternId = `stripes_${color}`;
        const pattern = `
    <pattern id="${patternId}" patternUnits="userSpaceOnUse" width="6" height="6">
      <rect width="3" height="6" fill="${colors[color]}" opacity="0.55"/>
      <rect x="3" width="3" height="6" fill="white" />
    </pattern>
  `;

        function fill(base) {
            if (shading === 0) return base; // solid
            if (shading === 1) return `url(#${patternId})`;
            return "none";
        }

        function renderShape(cx, cy) {
            switch (symbol) {
                case 0: // oval
                    return `<ellipse cx="${cx}" cy="${cy}" rx="32" ry="16" stroke="${colors[color]}"
                stroke-width="4" fill="${fill(colors[color])}" />`;
                case 1: // diamond
                    return `<polygon points="${cx-28},${cy} ${cx},${cy-17} ${cx+28},${cy} ${cx},${cy+17}"
                stroke="${colors[color]}" stroke-width="4" fill="${fill(colors[color])}" />`;
                case 2: { // squiggle — official shape, scaled and centered
                    // Based on original box ~108x59, center ~[58.5,36.5]
                    const scale = 0.57; // fits nicely in 64x32 box
                    const pathOffsetX = 58.5;
                    const pathOffsetY = 36.5;
                    return `<g transform="translate(${cx - scale * pathOffsetX},${cy - scale * pathOffsetY}) scale(${scale})">
                <path d="M104 15
                    C112.4 36.9,89.7 60.8,63.0 54.0
                    C52.3 51.3,42.2 42.0,27.0 53.0
                    C9.6 65.6,5.4 58.3,5.0 40.0
                    C4.6 22.0,19.1 9.7,36.0 12.0
                    C59.2 15.2,61.9 31.5,89.0 14.0
                    C95.3 10.0,100.9 6.9,104.0 15.0"
                    stroke="${colors[color]}"
                    stroke-width="4"
                    fill="${fill(colors[color])}"
                    shape-rendering="geometricPrecision"
                />
            </g>`;
                }
                default:
                    return "";
            }
        }



        const symbols = symbolYs.map(y => renderShape(width/2, y)).join('\n');
        return `
<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
  <defs>
    ${shading === 1 ? pattern : ''}
  </defs>
  <rect x="0" y="0" width="${width}" height="${height}" rx="14" fill="white" stroke="#aaa" stroke-width="2"/>
  ${symbols}
</svg>
  `.trim();
    }

    // Set logic: is it a set? (no Set object)
    function isSet([a, b, c]) {
        for (let i = 0; i < 4; i++) {
            const x = a[i], y = b[i], z = c[i];
            const allSame = x === y && y === z;
            const allDiff = x !== y && x !== z && y !== z;
            if (!allSame && !allDiff) return false;
        }
        return true;
    }


    // App state
    let deck, board, selected = [], messageDiv, boardDiv, deckDiv;
    function setup() {
        deck = generateDeck();
        shuffle(deck);
        board = [];
        selected = [];
        messageDiv = document.getElementById('message');
        boardDiv = document.getElementById('board');
        deckDiv = document.getElementById('deckcount');
        for (let i = 0; i < 12; i++) dealCardToBoard();
        render();
    }
    function dealCardToBoard() {
        if (deck.length) board.push(deck.pop());
    }
    function render() {
        boardDiv.innerHTML = '';
        board.forEach((card, idx) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.style.width = "120px";
            div.style.height = "180px";
            div.innerHTML = cardToSVG(card);
            if (selected.includes(idx)) div.classList.add('selected');
            div.onclick = () => handleSelect(idx);
            boardDiv.appendChild(div);
        });
        deckDiv.textContent = `Cards left in deck: ${deck.length}`;
    }
    function handleSelect(idx) {
        if (selected.includes(idx)) {
            selected = selected.filter(i => i !== idx);
        } else if (selected.length < 3) {
            selected.push(idx);
            if (selected.length === 3) checkSet();
        }
        render();
        highlightSelection();
    }
    function highlightSelection(setStatus) {
        // Visual feedback after 3 selected
        if (selected.length === 3 && setStatus !== undefined) {
            const cards = document.querySelectorAll('.card');
            selected.forEach(i => {
                cards[i].classList.remove('selected');
                cards[i].classList.add(setStatus ? 'set' : 'notset');
            });
        }
    }
    function checkSet() {
        const selCards = selected.map(i => board[i]);
        const valid = isSet(selCards);
        highlightSelection(valid);
        messageDiv.textContent = valid ? "✔️ SET!" : "❌ Not a Set!";
        setTimeout(() => {
            if (valid) {
                // Remove from board highest idx first
                selected.sort((a,b)=>b-a).forEach(i=>board.splice(i,1));
                while (board.length < 12 && deck.length) dealCardToBoard();
            }
            selected = [];
            render();
            messageDiv.textContent = '';
        }, 900);
    }
    // Add 3 more cards to board if deck available
    document.getElementById('add3').onclick = () => {
        if (deck.length < 3) return;
        for (let i = 0; i < 3; i++) dealCardToBoard();
        render();
    };
    // Restart button
    document.getElementById('restart').onclick = setup;
    document.getElementById('noSet').onclick = () => {
        const setFound = findAnySet(board);
        if (setFound) {
            alert("There IS a set on the board!");
        } else if (deck.length >= 3) {
            for (let i = 0; i < 3; i++) dealCardToBoard();
            render();
        } else {
            alert("No sets on board, and no more cards in deck!");
        }
    };
    document.getElementById('highlightSet').onclick = () => {
        const setFound = findAnySet(board);
        if (!setFound) {
            alert("No set found on the board!");
            return;
        }
        const cards = document.querySelectorAll('.card');
        setFound.forEach(i => cards[i].classList.add('hint'));
        setTimeout(() => {
            setFound.forEach(i => cards[i].classList.remove('hint'));
        }, 1100); // 1.1 seconds
    };


    // Start
    setup();
</script>
</body>
</html>
